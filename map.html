<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML Strict//EN">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <title>30 Years Maptaphut</title>
    <script type="text/javascript" src="underscore.js"></script>
    <script type="text/javascript" src="js/jquery-1.8.3.js"></script>
    <script src="http://code.jquery.com/ui/1.9.1/jquery-ui.js"></script>
    <script type="text/javascript" src="common.js"></script>
    <script type="text/javascript" src="map.js"></script>
    <script type="text/javascript" src="js/jquery.svg.package/jquery.svg.js"></script>
    <script type="text/javascript" src="js/tipsy/javascripts/jquery.tipsy.js"></script>
    <script type="text/javascript" src="js/colorbox/jquery.colorbox.js"></script>
    <link rel="stylesheet" href="js/colorbox/colorbox.css" />
    <link rel="stylesheet" href="css/custom.css" />
		<link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.1/themes/base/jquery-ui.css" />
    <link rel="stylesheet" href="js/tipsy/stylesheets/tipsy.css" />

    <script type="text/javascript" src="graph.js"></script>
    <style type="text/css" media="screen">
        #nsw, #vic, #wa, #sa, #nt, #qld, #tas {
            display: none;
            height: 400px;
            overflow: auto;
            position: absolute;
            right: 0;
            top: 0;
            width: 300px;
        }
        h2 {
            text-align: center;
        }
    </style>
    <script>
        $(function() {
            window.currentYear = "2555"
            $( "#slider-range-max" ).slider({
            value:2555,
            min: 2520,
            max: 2555,
            step: 1,
                slide: function( event, ui ) {
                    window.currentYear = ui.value

                    //For debug on screen
                    var val = $( "#amount" ).val( ui.value );

                    LayerManager.show(currentYear || 2555, getCurrentLayers('#map-control'));
                    showGraphGuide(ui.value)
                }
            });

            //Update #amount (first time)
            $( "#amount" ).val( $( "#slider-range-max" ).slider( "value" ) );
            setTimeout(function() { showGraphGuide(currentYear) }, 400)
        });

        var showGraphGuide = function(currentYear) {
            var snapYear = function(val) {
              return _.find(["2520", "2523", "2529", "2531", "2534", "2535", "2538", "2539", "2540", "2543", "2544", "2539", "2551", "2553", "2549"].sort().reverse(), function(item) {
                return item <= val
              })
            }
            var snapped = snapYear(currentYear);
            var selector = '#graph-overlay g[id^="'+ snapped +'"]';

            $('#graph-overlay').show();
            $('#graph-overlay g').hide();
            $(selector).show();
        }
    </script>

    <body style="margin:0px; padding:3px 0px 0px 0px;">
	    <div class="content">
	        <h1 id="title">30 Years Maptaphut</h1>
	        <div id="graph-wrapper">
	            <div id="svggraph"></div>
	            <div id="graph-control"></div>
	        </div>
	
	        <div id="slider-wrapper">
	            <div id="slider-range-max"></div>
	        </div>
	
	        <div id="svgprime"></div>
	
	        <div id="map-wrapper">
	            <div id="svgload"></div>
	            <div id="map-control" style="width:200px"> </div>
	        </div>
	        <p class="debug">
	            <label for="amount">Year:</label>
	            <input type="text" id="amount" style="border: 0; color: #f6931f; font-weight: bold;" />
	        </p>
        </div>
    </body>
</html>

